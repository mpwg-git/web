var EndlessScroll;EndlessScroll=function(){function b(b,c){var d=this;this.options=$.extend({},a,c),this.pagesStack=[0],this.scrollDirection="next",this.firing=!0,this.fired=!1,this.fireSequence=0,this.pageSequence=0,this.nextSequence=1,this.prevSequence=-1,this.lastScrollTop=0,this.insertLocation=this.options.insertAfter,this.didScroll=!1,this.isScrollable=!0,this.target=b,this.targetId="",this.content="",this.lastContent="dummy",this.innerWrap=$(".endless_scroll_inner_wrap",this.target),this.handleDeprecatedOptions(),this.setInsertPositionsWhenNecessary(),$(b).scroll(function(){return d.detectTarget(b),d.detectScrollDirection()})}var a;return b.name="EndlessScroll",a={pagesToKeep:null,inflowPixels:50,fireOnce:!0,fireDelay:150,loader:"Loading...",content:"",insertBefore:null,insertAfter:null,intervalFrequency:250,ceaseFireOnEmpty:!0,resetCounter:function(){return!1},callback:function(){return!0},ceaseFire:function(){return!1}},b.prototype.run=function(){var a=this;return setInterval(function(){if(a.shouldTryFiring()&&!a.ceaseFireWhenNecessary()&&a.shouldBeFiring())return a.resetFireSequenceWhenNecessary(),a.acknowledgeFiring(),a.insertLoader(),a.hasContent()&&(a.showContent(),a.fireCallback(),a.cleanUpPagesWhenNecessary(),a.delayFiringWhenNecessary()),a.removeLoader(),a.lastContent=a.content},this.options.intervalFrequency)},b.prototype.handleDeprecatedOptions=function(){if(this.options.data&&(this.options.content=this.options.data),this.options.bottomPixels)return this.options.inflowPixels=this.options.bottomPixels},b.prototype.setInsertPositionsWhenNecessary=function(){var b;if(b=""+this.target.selector+" div.endless_scroll_inner_wrap",null===a.insertBefore&&(this.options.insertBefore=""+b+" div:first"),null===a.insertAfter)return this.options.insertAfter=""+b+" div:last"},b.prototype.detectTarget=function(a){return this.target=a,this.targetId=$(this.target).attr("id")},b.prototype.detectScrollDirection=function(){var a;return this.didScroll=!0,a=$(this.target).scrollTop(),a>this.lastScrollTop?this.scrollDirection="next":this.scrollDirection="prev",this.lastScrollTop=a},b.prototype.shouldTryFiring=function(){var a;return a=this.didScroll&&this.firing===!0,a&&(this.didScroll=!1),a},b.prototype.ceaseFireWhenNecessary=function(){return!!(this.options.ceaseFireOnEmpty===!0&&""===this.lastContent||this.options.ceaseFire.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection]))&&(this.firing=!1,!0)},b.prototype.wrapContainer=function(a){if(0===this.innerWrap.length)return this.innerWrap=$(a).wrapInner('<div class="endless_scroll_content" data-page="0" />').wrapInner('<div class="endless_scroll_inner_wrap" />').find(".endless_scroll_inner_wrap")},b.prototype.scrollableAreaMargin=function(a,b){var c;switch(this.scrollDirection){case"next":c=a.height()-$(b).height()<=$(b).scrollTop()+this.options.inflowPixels,c&&b.scrollTop(a.height()-$(b).height()-this.options.inflowPixels);break;case"prev":c=$(b).scrollTop()<=this.options.inflowPixels,c&&b.scrollTop(this.options.inflowPixels)}return c},b.prototype.calculateScrollableCanvas=function(){return this.target[0]===document||this.target[0]===window?(this.wrapContainer("body"),this.isScrollable=this.scrollableAreaMargin($(document),$(window))):(this.wrapContainer(this.target),this.isScrollable=this.innerWrap.length>0&&this.scrollableAreaMargin(this.innerWrap,this.target))},b.prototype.shouldBeFiring=function(){return this.calculateScrollableCanvas(),this.isScrollable&&(this.options.fireOnce===!1||this.options.fireOnce===!0&&this.fired!==!0)},b.prototype.resetFireSequenceWhenNecessary=function(){if(this.options.resetCounter.apply(this.target)===!0)return this.fireSequence=0},b.prototype.acknowledgeFiring=function(){switch(this.fired=!0,this.fireSequence++,this.scrollDirection){case"next":return this.pageSequence=this.nextSequence++;case"prev":return this.pageSequence=this.prevSequence--}},b.prototype.insertContent=function(a){switch(this.scrollDirection){case"next":return $(this.options.insertAfter).after(a);case"prev":return $(this.options.insertBefore).before(a)}},b.prototype.insertLoader=function(){return this.insertContent('<div class="endless_scroll_loader_'+this.targetId+'      endless_scroll_loader">'+this.options.loader+"</div>")},b.prototype.removeLoader=function(){return $(".endless_scroll_loader_"+this.targetId).fadeOut(function(){return $(this).remove()})},b.prototype.hasContent=function(){return"function"==typeof this.options.content?this.content=this.options.content.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection]):this.content=this.options.content,this.content!==!1},b.prototype.showContent=function(){return $("#endless_scroll_content_current").removeAttr("id"),this.insertContent('<div id="endless_scroll_content_current"      class="endless_scroll_content" data-page="'+this.pageSequence+'">'+this.content+"</div>")},b.prototype.fireCallback=function(){return this.options.callback.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection])},b.prototype.cleanUpPagesWhenNecessary=function(){var a;if(this.options.pagesToKeep>=1){switch(this.scrollDirection){case"next":this.pagesStack.push(this.pageSequence);break;case"prev":this.pagesStack.unshift(this.pageSequence)}if(this.pagesStack.length>this.options.pagesToKeep)switch(this.scrollDirection){case"next":a=this.prevSequence=this.pagesStack.shift();break;case"prev":a=this.nextSequence=this.pagesStack.pop()}return this.removePage(a),this.calculateScrollableCanvas()}},b.prototype.removePage=function(a){return $(".endless_scroll_content[data-page='"+a+"']",this.target).remove()},b.prototype.delayFiringWhenNecessary=function(){var a=this;return this.options.fireDelay>0?($("body").after('<div id="endless_scroll_marker"></div>'),$("#endless_scroll_marker").fadeTo(this.options.fireDelay,1,function(){return $("#endless_scroll_marker").remove(),a.fired=!1})):this.fired=!1},b}(),function(a){return a.fn.endlessScroll=function(a){return new EndlessScroll(this,a).run()}}(jQuery);
