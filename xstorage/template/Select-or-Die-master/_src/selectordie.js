;(function($){"use strict";$.fn.selectOrDie=function(method){var $defaults={customID:null,customClass:"",placeholder:null,placeholderOption:false,prefix:null,cycle:false,stripEmpty:false,links:false,linksExternal:false,size:0,tabIndex:0,onChange:$.noop},$_settings={},$_sodKeysWhenClosed=false,$_sodFilterTimeout,$_sodViewportTimeout;var _private={initSoD:function(options){$_settings=$.extend({},$defaults,options);return this.each(function(){if(!$(this).parent().hasClass("sod_select")){var $select=$(this),$settingsId=$select.data("custom-id")?$select.data("custom-id"):$_settings.customID,$settingsClass=$select.data("custom-class")?$select.data("custom-class"):$_settings.customClass,$settingsPrefix=$select.data("prefix")?$select.data("prefix"):$_settings.prefix,$settingsPlaceholder=$select.data("placeholder")?$select.data("placeholder"):$_settings.placeholder,$settingsPlaceholderOption=$select.data("placeholder-option")?$select.data("placeholder-option"):$_settings.placeholderOption,$settingsCycle=$select.data("cycle")?$select.data("cycle"):$_settings.cycle,$settingsLinks=$select.data("links")?$select.data("links"):$_settings.links,$settingsLinksExternal=$select.data("links-external")?$select.data("links-external"):$_settings.linksExternal,$settingsSize=parseInt($select.data("size"))?$select.data("size"):$_settings.size,$settingsTabIndex=parseInt($select.data("tabindex"))?$select.data("tabindex"):($_settings.tabIndex?$_settings.tabIndex:($select.attr("tabindex")?$select.attr("tabindex"):$_settings.tabIndex)),$settingsStripEmpty=$select.data("strip-empty")?$select.data("strip-empty"):$_settings.stripEmpty,$selectTitle=$select.prop("title")?$select.prop("title"):null,$selectDisabled=$select.is(":disabled")?" disabled":"",$sodPrefix="",$sodHtml="",$sodHeight=0,$sod,$sodListWrapper,$sodList;if($settingsPrefix){$sodPrefix="<span class=\"sod_prefix\">"+$settingsPrefix+"</span> ";}if($settingsPlaceholder&&!$settingsPrefix){$sodHtml+="<span class=\"sod_label sod_placeholder\">"+$settingsPlaceholder+"</span>";}else{$sodHtml+="<span class=\"sod_label\">"+$sodPrefix+"</span>";}$sod=$("<span/>",{id:$settingsId,"class":"sod_select "+$settingsClass+$selectDisabled,title:$selectTitle,tabindex:$settingsTabIndex,html:$sodHtml,"data-cycle":$settingsCycle,"data-links":$settingsLinks,"data-links-external":$settingsLinksExternal,"data-placeholder":$settingsPlaceholder,"data-placeholder-option":$settingsPlaceholderOption,"data-prefix":$settingsPrefix,"data-filter":""}).insertAfter(this);if(_private.isTouch()){$sod.addClass("touch");}$sodListWrapper=$("<span/>",{"class":"sod_list_wrapper"}).appendTo($sod);$sodList=$("<span/>",{"class":"sod_list"}).appendTo($sodListWrapper);$("option, optgroup",$select).each(function(i){var $this=$(this);if($settingsStripEmpty&&!$.trim($this.text())){$this.remove();}else if(i===0&&$settingsPlaceholderOption&&!$sodPrefix)_private.populateSoD($this,$sodList,$sod,true);else{_private.populateSoD($this,$sodList,$sod,false);}});if($settingsSize){$sodListWrapper.show();$(".sod_option:lt("+$settingsSize+")",$sodList).each(function(){$sodHeight+=$(this).outerHeight();});$sodListWrapper.removeAttr("style");$sodList.css({"max-height":$sodHeight});}$select.appendTo($sod);$sod.on("focusin",_private.focusSod).on("click",_private.triggerSod).on("click",".sod_option",_private.optionClick).on("mousemove",".sod_option",_private.optionHover).on("keydown",_private.keyboardUse);$select.on("change",_private.selectChange);$(document).on("click","label[for='"+$select.attr("id")+"']",function(e){e.preventDefault();$sod.focus();});}else{console.log("Select or Die: It looks like the SoD already exists");}});},populateSoD:function($option,$sodList,$sod,$isPlaceholder){var $sodPlaceholder=$sod.data("placeholder"),$sodPlaceholderOption=$sod.data("placeholder-option"),$sodPrefix=$sod.data("prefix"),$sodLabel=$sod.find(".sod_label"),$optionParent=$option.parent(),$optionText=$option.text(),$optionValue=$option.val(),$optionCustomId=$option.data("custom-id")?$option.data("custom-id"):null,$optionCustomClass=$option.data("custom-class")?$option.data("custom-class"):"",$optionIsDisabled=$option.is(":disabled")?" disabled ":"",$optionIsSelected=$option.is(":selected")?" selected active ":"",$optionLink=$option.data("link")?" link ":"",$optionLinkExternal=$option.data("link-external")?" linkexternal":"",$optgroupLabel=$option.prop("label");if($option.is("option")){$("<span/>",{"class":"sod_option "+$optionCustomClass+$optionIsDisabled+$optionIsSelected+$optionLink+$optionLinkExternal,id:$optionCustomId,title:$optionText,html:$optionText,"data-value":$optionValue}).appendTo($sodList);if($isPlaceholder&&!$sodPrefix){$sod.data("label",$optionText);$sod.data("placeholder",$optionText);$option.prop("disabled",true);$sodList.find(".sod_option:last").addClass("is-placeholder disabled");if($optionIsSelected){$sodLabel.addClass("sod_placeholder");}}else if($optionIsSelected&&$sodPlaceholder&&!$sodPlaceholderOption&&!$sodPrefix){$sod.data("label",$sodPlaceholder);}else if($optionIsSelected){$sod.data("label",$optionText);}if($optionIsSelected&&!$sodPlaceholder||$optionIsSelected&&$sodPlaceholderOption||$optionIsSelected&&$sodPrefix){$sodLabel.append($optionText);}if($optionParent.is("optgroup")){$sodList.find(".sod_option:last").addClass("groupchild");if($optionParent.is(":disabled")){$sodList.find(".sod_option:last").addClass("disabled");}}}else{$("<span/>",{"class":"sod_option optgroup "+$optionIsDisabled,title:$optgroupLabel,html:$optgroupLabel,"data-label":$optgroupLabel}).appendTo($sodList);}},focusSod:function(){var $sod=$(this);if(!$sod.hasClass("disabled")){_private.blurSod($(".sod_select.focus").not($sod));$sod.addClass("focus");$("html").on("click.sodBlur",function(){_private.blurSod($sod);});}else{_private.blurSod($sod);}},triggerSod:function(e){e.stopPropagation();var $sod=$(this),$sodList=$sod.find(".sod_list"),$sodPlaceholder=$sod.data("placeholder"),$optionActive=$sod.find(".active"),$optionSelected=$sod.find(".selected");if(!$sod.hasClass("disabled")&&!$sod.hasClass("open")&&!$sod.hasClass("touch")){$sod.addClass("open");if($sodPlaceholder&&!$sod.data("prefix")){$sod.find(".sod_label").addClass("sod_placeholder").html($sodPlaceholder);}_private.listScroll($sodList,$optionSelected);_private.checkViewport($sod,$sodList);}else{clearTimeout($_sodViewportTimeout);$sod.removeClass("open");if($sodPlaceholder){$sod.find(".sod_label").get(0).lastChild.nodeValue=$optionActive.text();}}},keyboardUse:function(e){var $sod=$(this),$sodList=$sod.find(".sod_list"),$sodOptions=$sod.find(".sod_option"),$sodLabel=$sod.find(".sod_label"),$sodCycle=$sod.data("cycle"),$optionActive=$sodOptions.filter(".active"),$sodFilterHit,$optionNext,$optionCycle;if(e.which>36&&e.which<41){if(e.which===37||e.which===38){$optionNext=$optionActive.prevAll(":not('.disabled, .optgroup')").first();$optionCycle=$sodOptions.not(".disabled, .optgroup").last();}else if(e.which===39||e.which===40){$optionNext=$optionActive.nextAll(":not('.disabled, .optgroup')").first();$optionCycle=$sodOptions.not(".disabled, .optgroup").first();}if(!$optionNext.hasClass("sod_option")&&$sodCycle){$optionNext=$optionCycle;}if($optionNext.hasClass("sod_option")||$sodCycle){$optionActive.removeClass("active");$optionNext.addClass("active");$sodLabel.get(0).lastChild.nodeValue=$optionNext.text();_private.listScroll($sodList,$optionNext);if(!$sod.hasClass("open")){$_sodKeysWhenClosed=true;}}return false;}else if(e.which===13||(e.which===32&&$sod.hasClass("open")&&($sod.data("filter")[0]===' '||$sod.data("filter")===""))){e.preventDefault();$optionActive.click();}else if(e.which===32&&!$sod.hasClass("open")&&($sod.data("filter")[0]===' '||$sod.data("filter")==="")){e.preventDefault();$_sodKeysWhenClosed=false;$sod.click();}else if(e.which===27){_private.blurSod($sod);}if(e.which!==0){clearTimeout($_sodFilterTimeout);$sod.data("filter",$sod.data("filter")+String.fromCharCode(e.which));$sodFilterHit=$sodOptions.filter(function(){return $(this).text().toLowerCase().indexOf($sod.data("filter").toLowerCase())===0;}).not(".disabled, .optgroup").first();if($sodFilterHit.length){$optionActive.removeClass("active");$sodFilterHit.addClass("active");_private.listScroll($sodList,$sodFilterHit);$sodLabel.get(0).lastChild.nodeValue=$sodFilterHit.text();if(!$sod.hasClass("open")){$_sodKeysWhenClosed=true;}}$_sodFilterTimeout=setTimeout(function(){$sod.data("filter","");},500);}},optionHover:function(){var $option=$(this);if(!$option.hasClass("disabled")&&!$option.hasClass("optgroup")){$option.siblings().removeClass("active").end().addClass("active");}},optionClick:function(e){e.stopPropagation();var $clicked=$(this),$sod=$clicked.closest(".sod_select"),$optionDisabled=$clicked.hasClass("disabled"),$optionOptgroup=$clicked.hasClass("optgroup"),$optionIndex=$sod.find(".sod_option:not('.optgroup')").index(this);if($sod.hasClass("touch")){return;}if(!$optionDisabled&&!$optionOptgroup){$sod.find(".selected, .sod_placeholder").removeClass("selected sod_placeholder");$clicked.addClass("selected");$sod.find("select option")[$optionIndex].selected=true;$sod.find("select").change();}clearTimeout($_sodViewportTimeout);$sod.removeClass("open");},selectChange:function(){var $select=$(this),$optionSelected=$select.find(":selected"),$optionText=$optionSelected.text(),$sod=$select.closest(".sod_select");$sod.find(".sod_label").get(0).lastChild.nodeValue=$optionText;$sod.data("label",$optionText);$_settings.onChange.call(this);if(($sod.data("links")||$optionSelected.data("link"))&&!$optionSelected.data("link-external")){window.location.href=$optionSelected.val();}else if($sod.data("links-external")||$optionSelected.data("link-external")){window.open($optionSelected.val(),"_blank");}},blurSod:function($sod){if($("body").find($sod).length){var $sodLabel=$sod.data("label"),$sodPlaceholder=$sod.data("placeholder"),$optionActive=$sod.find(".active"),$optionSelected=$sod.find(".selected"),$optionHasChanged=false;clearTimeout($_sodViewportTimeout);if($_sodKeysWhenClosed&&!$optionActive.hasClass("selected")){$optionActive.click();$optionHasChanged=true;}else if(!$optionActive.hasClass("selected")){$optionActive.removeClass("active");$optionSelected.addClass("active");}if(!$optionHasChanged&&$sodPlaceholder){$sod.find(".sod_label").get(0).lastChild.nodeValue=$optionSelected.text();}else if(!$optionHasChanged){$sod.find(".sod_label").get(0).lastChild.nodeValue=$sodLabel;}$_sodKeysWhenClosed=false;$sod.removeClass("open focus");$sod.blur();$("html").off(".sodBlur");}},checkViewport:function($sod,$sodList){var $sodPosition=$sod[0].getBoundingClientRect(),$sodListHeight=$sodList.outerHeight();if(($sodPosition.bottom+$sodListHeight+10)>$(window).height()&&($sodPosition.top-$sodListHeight)>10){$sod.addClass("above");}else{$sod.removeClass("above");}$_sodViewportTimeout=setTimeout(function(){_private.checkViewport($sod,$sodList);},200);},listScroll:function($sodList,$option){var $scrollList=$sodList[0].getBoundingClientRect(),$scrollOption=$option[0].getBoundingClientRect();if($scrollList.top>$scrollOption.top){$sodList.scrollTop($sodList.scrollTop()-$scrollList.top+$scrollOption.top);}else if($scrollList.bottom<$scrollOption.bottom){$sodList.scrollTop($sodList.scrollTop()-$scrollList.bottom+$scrollOption.bottom);}},isTouch:function(){return(("ontouchstart"in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));}};var methods={destroy:function(){return this.each(function(){var $select=$(this),$sod=$select.parent();if($sod.hasClass("sod_select")){$select.off("change");$sod.find("span").remove();$select.unwrap();}else{console.log("Select or Die: There's no SoD to destroy");}});},update:function(){return this.each(function(){var $select=$(this),$sod=$select.parent(),$sodList=$sod.find(".sod_list:first");if($sod.hasClass("sod_select")){$sodList.empty();$sod.find(".sod_label").get(0).lastChild.nodeValue="";if($select.is(":disabled")){$sod.addClass("disabled");}$("option, optgroup",$select).each(function(){_private.populateSoD($(this),$sodList,$sod);});}else{console.log("Select or Die: There's no SoD to update");}});},disable:function($value){return this.each(function(){var $select=$(this),$sod=$select.parent();if($sod.hasClass("sod_select")){if(typeof $value!=="undefined"){$sod.find(".sod_list:first .sod_option[data-value='"+$value+"']").addClass("disabled");$sod.find(".sod_list:first .sod_option[data-label='"+$value+"']").nextUntil(":not(.groupchild)").addClass("disabled");$("option[value='"+$value+"'], optgroup[label='"+$value+"']",this).prop("disabled",true);}else if($sod.hasClass("sod_select")){$sod.addClass("disabled");$select.prop("disabled",true);}}else{console.log("Select or Die: There's no SoD to disable");}});},enable:function($value){return this.each(function(){var $select=$(this),$sod=$select.parent();if($sod.hasClass("sod_select")){if(typeof $value!=="undefined"){$sod.find(".sod_list:first .sod_option[data-value='"+$value+"']").removeClass("disabled");$sod.find(".sod_list:first .sod_option[data-label='"+$value+"']").nextUntil(":not(.groupchild)").removeClass("disabled");$("option[value='"+$value+"'], optgroup[label='"+$value+"']",this).prop("disabled",false);}else if($sod.hasClass("sod_select")){$sod.removeClass("disabled");$select.prop("disabled",false);}}else{console.log("Select or Die: There's no SoD to enable");}});}};if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==="object"||!method){return _private.initSoD.apply(this,arguments);}else{$.error("Select or Die: Oh no! No such method \""+method+"\" for the SoD instance");}};})(jQuery);