var delRoomOnce=!1,deactAccountOnce=!1,base64Img=!1,cropData=!1,fe_user=function(){return new function(){this.init=function(){this.jcrop_api,this.registerListeners(),this.registerUploadListeners()},this.registerListeners=function(){var a=this;$(".js-accept-join").unbind("click"),$(".js-accept-join").click(function(a){a.preventDefault(),$(".ajax-loader").show();var b=$(this).data("room"),c={room:b};$.ajax({type:"POST",url:"/xsite/call/fe_room/acceptInvitation",data:c,success:function(a){$(".ajax-loader").hide(),location.reload(!0)}})}),$(".js-reject-join").unbind("click"),$(".js-reject-join").click(function(a){a.preventDefault(),$(".ajax-loader").show();var b=$(this).data("room"),c={room:b};$.ajax({type:"POST",url:"/xsite/call/fe_room/rejectInvitation",data:c,success:function(a){$(".ajax-loader").hide(),location.reload(!0)}})}),$(document).off("click","#form-del-account").on("click","#form-del-account",function(a){if(1!=delRoomOnce){delRoomOnce=!0;var b=$(this);b.popover({placement:"top",content:'<span class="wirklich">'+top.delete_word1+'<br/><span class="loeschen">'+top.delete_word2+'?</span></span><div class="button-container"><button id="del-account" class="button btn js-btn-confirm-ja">'+top.str_yes+'</button><button class="button btn js-btn-confirm-nein">'+top.str_no+"</button>",html:!0,callback:function(){$(".js-btn-confirm-ja").unbind("click"),$(".js-btn-confirm-ja").click(function(){fe_user.delContent("disable_my_account",0)}),$(".js-btn-confirm-nein").unbind("click"),$(".js-btn-confirm-nein").click(function(){b.popover("hide")}),delRoomOnce=!1}}),b.popover("show")}}),$(".js-delete-room-popup").unbind("click"),$(document).on("click",".js-delete-room-popup",function(a){if(a.preventDefault(),1!=delRoomOnce){delRoomOnce=!0;var b=$(this).attr("data-room"),c="room",d=$(this);d.popover({placement:3==fe_core.getCurrentFace()?"left":"bottom",content:'<span class="wirklich">'+top.delete_word1+'<br/><span class="loeschen">'+top.delete_word2+'?</span></span><div class="button-container"><button id="delete-room" class="button btn js-btn-confirm-ja">'+top.str_yes+'</button><button class="button btn js-btn-confirm-nein">'+top.str_no+"</button>",html:!0,callback:function(){var a=c,e=b;$(".js-btn-confirm-ja").unbind("click"),$(".js-btn-confirm-ja").click(function(){fe_user.delContent(a,e)}),$(".js-btn-confirm-nein").unbind("click"),$(".js-btn-confirm-nein").click(function(a){a.preventDefault(),d.popover("hide")}),delRoomOnce=!1}}),d.popover("show"),delRoomOnce=!1}}),$("#neues-zimmer-anlegen").unbind("click"),$("#neues-zimmer-anlegen").one("click",function(){var a=$("#hiddenUserId").attr("value"),b={user:a};$.ajax({type:"POST",url:"/xsite/call/fe_room/sendMailNewRoom",data:b,success:function(a){console.log("send mail new room")}})}),$(".js-activate-room").unbind("click"),$(".js-activate-room").click(function(a){a.preventDefault(),$(".ajax-loader").show();var b=$(this).data("room"),c={room:b};$.ajax({type:"POST",url:"/xsite/call/fe_room/activateRoom",data:c,success:function(a){location.reload(!0)}})}),$(".js-deactivate-room").unbind("click"),$(".js-deactivate-room").click(function(a){a.preventDefault(),$(".ajax-loader").show();var b=$(this).data("room"),c={room:b};$.ajax({type:"POST",url:"/xsite/call/fe_room/deactivateRoom",data:c,success:function(a){location.reload(!0)}})}),$("#form-mein-profil-save").unbind("click"),$("#form-mein-profil-save").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-mein-profil")}),$("#form-raum-einladen-save").unbind("click"),$("#form-raum-einladen-save").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-raum-einladen")}),$("#form-mein-profil-save-user").unbind("click"),$("#form-mein-profil-save-user").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-mein-user")}),$("#form-deactivate-account").unbind("click"),$("#form-deactivate-account").click(function(a){if(a.preventDefault(),1!=deactAccountOnce){deactAccountOnce=!0;var b=$(this);b.popover({placement:"top",content:'<span class="wirklich">'+top.deactivate_word1+'<br/><span class="deaktivieren">'+top.deactivate_word2+'?</span></span><div class="button-container"><button id="deactivate-account" class="button btn js-btn-confirm-ja">'+top.str_yes+'</button><button class="button btn js-btn-confirm-nein">'+top.str_no+"</button>",html:!0,trigger:"manual",callback:function(){$(".js-btn-confirm-ja").unbind("click"),$(".js-btn-confirm-ja").click(function(){fe_user.delContent("user_inactive")}),$(".js-btn-confirm-nein").unbind("click"),$(".js-btn-confirm-nein").click(function(a){a.preventDefault(),b.popover("hide")}),deactAccountOnce=!1}}),b.popover("show"),deactAccountOnce=!1}}),$("#form-reactivate-account").unbind("click"),$("#form-reactivate-account").click(function(a){if(a.preventDefault(),1!=deactAccountOnce){deactAccountOnce=!0;var b=$(this);b.popover({placement:"top",content:'<span class="wirklich">'+top.activate_word1+'<br/><span class="aktivieren">'+top.activate_word2+'?</span></span><div class="button-container"><button class="button btn js-btn-confirm-ja">'+top.str_yes+'</button><button class="button btn js-btn-confirm-nein">'+top.str_no+"</button>",html:!0,callback:function(){$(".js-btn-confirm-ja").unbind("click"),$(".js-btn-confirm-ja").click(function(){fe_user.delContent("user_active")}),$(".js-btn-confirm-nein").unbind("click"),$(".js-btn-confirm-nein").click(function(){b.popover("hide")}),deactAccountOnce=!1}}),b.popover("show")}}),$(".form-mein-profil").unbind("submit"),$(".form-mein-profil").submit(function(a){a.preventDefault(),$(".ajax-loader").show();var b={};b.user=$(".form-mein-user").serialize(),b.profile=$(".form-mein-profil").serialize(),$.ajax({type:"POST",url:"/xsite/call/fe_user/profileSave",data:b,success:function(a){window.location.href=$("#form-mein-profil-save").data("redirect")}})}),$(".form-mein-raum").unbind("submit"),$(".form-mein-raum").submit(function(a){a.preventDefault();var b=fe_core.jsFormValidation("form-mein-raum");if("undefined"!=typeof b&&1==b){$(".ajax-loader").show();var c={};c.room=$(".form-mein-raum").serialize(),$.ajax({type:"POST",url:"/xsite/call/fe_room/profileSave",data:c,success:function(a){window.location.href=$("#form-mein-raum-save").data("redirect")}})}else b||$("#mCSB_2_container, #mCSB_2_dragger_vertical").animate({top:0,left:0},500);return!1}),$(".form-raum-einladen").unbind("submit"),$(".form-raum-einladen").submit(function(a){a.preventDefault(),$(".ajax-loader").show();var b={};b.form=$(".form-raum-einladen").serialize(),$.ajax({type:"POST",url:"/xsite/call/fe_room/sendInvitation",data:b,success:function(a){$(".ajax-loader").hide(),$(".js-success-notification").show()}})}),$(".form-mein-user").unbind("submit"),$(".form-mein-user").submit(function(a){a.preventDefault(),$(".ajax-loader").show();var b={user:$(".form-mein-user").serialize()};$.ajax({type:"POST",url:"/xsite/call/fe_user/profileSave",data:b,success:function(a){$(".ajax-loader").hide()}})}),$("#form-mein-profil-save").unbind("click"),$("#form-mein-profil-save").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-mein-profil")}),$("#form-login-submit").unbind("click"),$("#form-login-submit").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-login")}),$("#form-register-submit").unbind("click"),$("#form-register-submit").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("form-register")}),$("#form-pw-submit").unbind("click"),$("#form-pw-submit").click(function(a){return a.preventDefault(),fe_core.submitWithValidation("wz_form-login")}),$(".autocomplete-location").keydown(function(a){if(13==a.keyCode)return a.preventDefault(),a.stopPropagation(),!1}),$(".js-autocomplete-duck").unbind("click"),$(".js-autocomplete-duck").bind("click",function(a){var a=jQuery.Event("keydown");if(a.which=13,$(".autocomplete-location").focus().trigger(a),$("#map:visible").length>0){var b=autocomplete.getPlace();if(b){var c=b.geometry.location.lat(),d=b.geometry.location.lng();c>0&&d>0&&fe_map.centerMapOnPoint(c,d,$("#map"))}}}),$(".add-image-crop").unbind("click"),$(".add-image-crop").bind("click",function(b){b.preventDefault(),$.ajax({type:"POST",url:"/xsite/call/fe_user/cropImageAndSaveNew",data:cropData,success:function(b){$(".ajax-loader").hide(),b.success&&a.goToStep(2,b)}})}),$("#reset-password-btn").on("click",function(a){a.preventDefault();var b=fe_core.jsFormValidation("reset-password");if(!b)return!1;var c=$("#reset-password").serialize();fe_core.showLoader(),$.ajax({url:"/xsite/call/fe_user/reset_password",method:"POST",data:c,success:function(a){$("#currentPWD_error").hide(),$("#currentPWD_wrong_error").hide(),$("#change-password").find("input[type=password]").val(""),$("#reset-password").animate({display:"none"},250,function(){$(".thx-container").fadeIn(),fe_core.hideLoader()}),fe_core.hideLoader()},error:function(a){a.responseJSON.msg.id==-2&&($("#currentPWD_error").hide(),$("#currentPWD_wrong_error").show()),a.responseJSON.msg.id==-1&&$("#reset-password_PASSWORT2_error").show(),fe_core.hideLoader()}})}),$(".add-image-final-submit").unbind("click"),$(".add-image-final-submit").click(function(b){b.preventDefault(),a.handleFinalUpload($(".add-image-final-form"))}),$(".js-toggle-favourite").unbind("click"),$(".js-toggle-favourite").bind("click",function(a){a.preventDefault();var b=$(this).data("id"),c=$(this).data("type"),d=this;$.ajax({type:"POST",url:"/xsite/call/fe_user/toggleFav",data:{f_userId:b,theType:c},success:function(a){switch(a.state){case!0:$(d).find(".active").show(),$(d).find(".inactive").hide();break;case!1:$(d).find(".inactive").show(),$(d).find(".active").hide(),$(d).hasClass("js-toggle-fade")&&$(d).closest(".searchresult-single").fadeOut()}}})}),$(".js-toggle-blocked").unbind("click"),$(".js-toggle-blocked").bind("click",function(a){a.preventDefault();var b=$(this).data("id"),c=$(this).data("type"),d=this;$.ajax({type:"POST",url:"/xsite/call/fe_user/toggleBlock",data:{f_userId:b,theType:c},success:function(a){switch(a.state){case!0:$(d).find(".active").show(),$(d).find(".inactive").hide(),$(d).hasClass("js-toggle-fade")&&$(d).closest(".searchresult-single").fadeOut();break;case!1:$(d).find(".inactive").show(),$(d).find(".active").hide()}}})}),$(".image-slider").length>0&&$(".image-slider").royalSlider({autoHeight:!0,arrowsNav:!0,arrowsNavAutoHide:!1,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"bullets",thumbs:!1,imageScaleMode:"fill",imageAlignCenter:!1,loop:!1,loopRewind:!0,numImagesToPreload:6,keyboardNavEnabled:!1,usePreloader:!1,slidesSpacing:0}),$(".meinprofil-images-container .upload-image.hasImage").unbind("click"),$(".meinprofil-images-container .upload-image.hasImage").click(function(a){a.preventDefault(),$(this).find(".popover-del").show()}),$(".icon-plus-container").click(function(a){a.stopImmediatePropagation(),$(this).toggleClass("active")}),$(".icon-plus-container .icon-frau_outline").unbind("click"),$(".icon-plus-container .icon-frau_outline").click(function(b){var c=$(this).closest(".mitbewohner-container").find(".person");$(c).append('<span class="unchecked icon-frau_outline"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="icon-rel icon-minus-rel"></span></span>');var d=parseInt($("#mitbewohner-frauen-counter").val(),10);d++,$("#mitbewohner-frauen-counter").val(d),a.registerListeners()}),$(".icon-plus-container .icon-mann_outline").unbind("click"),$(".icon-plus-container .icon-mann_outline").click(function(b){var c=$(this).closest(".mitbewohner-container").find(".person");$(c).append('<span class="unchecked icon-mann_outline"><span class="path1"></span><span class="path2"></span><span class="icon-rel icon-minus-rel"></span></span>');var d=parseInt($("#mitbewohner-maenner-counter").val(),10);d++,$("#mitbewohner-maenner-counter").val(d),a.registerListeners()}),$(".mitbewohner-container .person .icon-frau_outline .icon-minus-rel").unbind("click"),$(".mitbewohner-container .person .icon-frau_outline .icon-minus-rel").click(function(a){$(this).closest(".icon-frau_outline").remove();var b=parseInt($("#mitbewohner-frauen-counter").val(),10);b--,$("#mitbewohner-frauen-counter").val(b)}),$(".mitbewohner-container .person .icon-mann_outline .icon-minus-rel").unbind("click"),$(".mitbewohner-container .person .icon-mann_outline .icon-minus-rel").click(function(a){$(this).closest(".icon-mann_outline").remove();var b=parseInt($("#mitbewohner-maenner-counter").val(),10);b--,$("#mitbewohner-maenner-counter").val(b)}),$(".js-hide-conversation").unbind("click"),$(".js-hide-conversation").click(function(a){a.preventDefault();var b=$(this).data("messageid"),c=$(this).data("userid");$.ajax({type:"POST",url:"/xsite/call/fe_chat/hideConversation",data:{messageId:b,userId:c},success:function(a){$(".chat-conversation-container[data-userid="+c+"]").remove()}})}),$(".js-chatwindow").length>0&&fe_chat.init(),jQuery.ui.autocomplete.prototype._resizeMenu=function(){var a=this.menu.element;a.outerWidth(this.element.outerWidth())},$(".js-search-personen").length>0&&($(".js-search-personen").autocomplete({source:function(a,b){$.ajax({url:"/xsite/call/fe_user/searchUser",dataType:"jsonp",data:{q:a.term},success:function(a){b(a),fe_core.hideLoader()}})},response:function(a,b){if(0===b.content.length){var c={value:"",label:"Leider kein Ergebnis gefunden"};b.content.push(c)}},minLength:3,select:function(a,b){a.preventDefault(),b.item.url&&($(".js-search-personen").val(b.item.label),window.location=b.item.url)}}).data("ui-autocomplete")._renderItem=function(a,b){return a.addClass("autocomplete-user-ul"),""==b.value?$('<li class="autocomplete-user-result autocomplete-user-not-found">').append("<a>"+b.label+"</a>").appendTo(a):$('<li class="autocomplete-user-result autocomplete-user-found">').append('<a href="'+b.url+'">'+b.label+"</a>").appendTo(a)});var b=$.fn.popover.Constructor.prototype.show;$.fn.popover.Constructor.prototype.show=function(){b.call(this),this.options.callback&&this.options.callback()},$(".popover-del").popover({placement:"right",content:'<span class="wirklich">'+top.delete_word1+'<br/><span class="loeschen">'+top.delete_word2+'?</span></span><div class="button-container"><button class="button btn js-btn-confirm-ja">'+top.str_yes+'</button><button class="button btn js-btn-confirm-nein">'+top.str_no+"</button>",html:!0,callback:function(){var b=this.deltype,c=this.delid;$(".js-btn-confirm-ja").unbind("click"),$(".js-btn-confirm-ja").click(function(){console.log("del",b,c),fe_user.delContent(b,c)}),$(".js-btn-confirm-nein").unbind("click"),$(".js-btn-confirm-nein").click(function(){$(".popover-del").popover("hide")})}}),a.registerUploadListeners()},this.delContent=function(a,b){$.ajax({type:"POST",url:"/xsite/call/fe_user/delContent",data:{type:a,id:b},success:function(a){if($("#form-mein-raum-save").length>0){var b=$("#form-mein-raum-save").data("redirect");if(""!=b)return void(window.location.href=b)}location.reload(!0)}})},this.registerUploadListeners=function(){var a=this;try{$(".add-image").bind("fileuploadsubmit",function(b,c){var d=$(this).data("type");a.type=d;var e=$(this).data("refid");a.refid=e,c.formData={type:d,refid:e,p_id:top.P_ID}}),$(".add-image").fileupload({formData:{fromFileupload:"true",p_id:top.P_ID},acceptFileTypes:/(\.|\/)(gif|jpe?g|png|tif|tiff|pdf)$/i,dataType:"json",maxNumberOfFiles:1,url:"/xsite/call/fe_user/uploadImage",type:"POST",beforeSend:function(b,c){"profile"==a.type?($(".add-image-profil .upload-progress-bar").css("height","10px"),$(".add-image-profil .upload-progress-bar").css("width","0%")):($(".add-image-other .upload-progress-bar").css("height","10px"),$(".add-image-other .upload-progress-bar").css("width","0%"))},progressall:function(b,c){var d=parseInt(c.loaded/c.total*100,10);"profile"==a.type?$(".add-image-profil .upload-progress-bar").animate({width:d+"%"}):$(".add-image-other .upload-progress-bar").animate({width:d+"%"})},add:function(a,b){b.submit()},fail:function(a,b){},done:function(b,c){$(".upload-progress-bar").css("height","0px"),$(".upload-progress-bar").css("width","0%"),1==c.result.success&&a.goToStep(1,c.result)}})}catch(a){}},this.imgCrop=function(){var c=(parseInt($("#trueOrigW").val(),10),parseInt($("#trueOrigH").val(),10),$("#avatarCrop")),d=.92,e=600*d,f=600,g={};g.s_id=$("#s_id").val(),g.p_id=top.P_ID,g.lang=top.P_LANG,g.refid=$('input[name="refid"]').first().val(),g.type=$('input[name="type"]').first().val(),3!=fe_core.getCurrentFace()?(g.trueCropW=0,g.trueCropH=0,g.trueX=0,g.trueY=0,cropData=g):c.smoothZoom({width:e,height:f,zoom_OUT_TO_FIT:!1,responsive:!0,pan_BUTTONS_SHOW:!1,responsive_maintain_ratio:!0,max_WIDTH:"",max_HEIGHT:"",on_ZOOM_PAN_UPDATE:function(a,b){},on_ZOOM_PAN_COMPLETE:function(a,b){g=a,g.s_id=$("#s_id").val(),g.p_id=top.P_ID,g.lang=top.P_LANG,g.refid=$('input[name="refid"]').first().val(),g.type=$('input[name="type"]').first().val(),g.selectionWidth=e,g.selectionHeight=f,g.uploader="smoothZoom",g.origW=parseInt($("#trueOrigW").val(),10),g.origH=parseInt($("#trueOrigH").val(),10),g.origRatioX=g.origW/g.normWidth,g.origRatioY=g.origH/g.normHeight,g.ratiox2=g.origW/g.scaledWidth,g.ratioy2=g.origH/g.scaledHeight,g.selRatio=d,g.trueX=parseFloat(g.normX)*g.origRatioX,g.trueY=parseFloat(g.normY)*g.origRatioY,g.trueCropW=g.selectionWidth/(g.selectionWidth/g.origW)/g.ratio,g.trueCropH=g.trueCropW/g.selRatio,cropData=g,$(".cropx").length>0&&($(".cropx").width(cropData.trueCropW),$(".cropx").height(cropData.trueCropH),$(".cropx").css("left",cropData.trueX+"px"),$(".cropx").css("top",cropData.trueY+"px"))}})},this.goToStep=function(a,b){var c=this;switch(a){case 1:$(".add-image-crop-area").html(b.data.html),$(".upload-image-modal").modal("show"),$(".upload-image-modal").on("shown.bs.modal",function(a){$(".avatarCrop").attr("src",b.src).css("height","auto"),"undefined"!=typeof c.jcrop_api&&c.jcrop_api.destroy(),c.imgCrop()});break;case 2:$(".add-image-crop-area").html(b.data.html);break;case 3:$(".upload-image-modal").modal("hide"),location.reload(!0)}c.registerListeners()},this.handleFinalUpload=function(a){var b=this;$(".ajax-loader").show();var c=$(a).serialize();$.ajax({type:"POST",url:"/xsite/call/fe_user/finalSubmit",data:c,success:function(a){$(".ajax-loader").hide(),a.success&&b.goToStep(3,a)}})}}}();$(document).ready(function(){fe_user.init()});
