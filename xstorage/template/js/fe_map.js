top.new_sliderdata=!1;var fe_map=function(){return new function(){this.init=function(){var a=this;this.firstCall=!0,this.allMarkers=[],this.registerListeners(),this.searchMap={map:null,marker:null,radius:{shape:null,value:10}},$(".map").length>0&&$(".map").each(function(b,c){var d=$(c);a.initializeSearchMap(d)}),$(".map2").length>0&&$(".map2").each(function(b,c){var d=$(c);a.initializeSearchMap(d)}),($(".js-replacer-search").length>0||$(".search-slider").length>0)&&1==this.firstCall&&(this.firstCall=!1,a.refreshSearch()),this.checkIfNeedToPan()},this.registerListeners=function(){var a=this;$(".searchresult-single").unbind("mouseenter"),$(".searchresult-single").mouseenter(function(){var b=$(this).find(".img-wrapper").data("userid");a.panToMarker(b)});var b=5;""!=$("#umkreis-slider").data("value")&&(b=parseInt($("#umkreis-slider").data("value"),10)),$("#umkreis-slider").slider({range:"min",value:b,min:1,max:50,slide:function(b,c){$(".ui-slider-handle","#umkreis-slider").first().html(c.value),null!=a.searchMap.radius.shape&&a.searchMap.radius.shape.setRadius(1e3*c.value)},stop:function(b,c){$("#umkreis-slider").data("value",c.value),a.refreshSearch()}}),$(".ui-slider-handle:first","#umkreis-slider").html($("#umkreis-slider").slider("value"));var c=75,d=400;if(""!=$("#slider-range").data("valueab")&&(c=parseInt($("#slider-range").data("valueab"),10)),""!=$("#slider-range").data("valuebis")&&(d=parseInt($("#slider-range").data("valuebis"),10)),$("#slider-range").slider({range:!0,min:1,max:1e3,values:[c,d],slide:function(a,b){var c=b.values[1]-b.values[0];return!(c<1)&&($(".ui-slider-handle","#slider-range").first().html("€ "+b.values[0]),void $(".ui-slider-handle","#slider-range").last().html("€ "+b.values[1]))},stop:function(a,b){$("span.ui-slider-handle.ui-state-default.ui-corner-all").css("z-Index",2),$(b.handle).css("z-Index",3),$("#slider-range").data("valueab",b.values[0]),$("#slider-range").data("valuebis",b.values[1]),fe_map.refreshSearch()}}),$(".ui-slider-handle:first","#slider-range").html("€ "+$("#slider-range").slider("values",0)),$(".ui-slider-handle:last","#slider-range").html("€ "+$("#slider-range").slider("values",1)),$(".search-slider").length>0){var e=$(".search-slider").data("royalSlider");"undefined"!=typeof e&&e.destroy(),setTimeout(function(){$(".search-slider").royalSlider({arrowsNav:!1,arrowsNavAutoHide:!1,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"none",thumbs:!1,imageScaleMode:"fill",imageAlignCenter:!1,loop:!1,loopRewind:!0,numImagesToPreload:6,keyboardNavEnabled:!0,usePreloader:!1,slidesSpacing:0,navigateByClick:!1});var b=$(".search-slider").data("royalSlider");b.ev.on("rsAfterSlideChange",function(){b.numSlides==b.currSlideId+1&&(console.log("last slide! activating endless scrolling mobile"),a.activateEndlessScrollingMobile()),a.registerListenersForSlider()}),a.registerListenersForSlider()},500)}$(".js-toggle-map").unbind("click"),$(".js-toggle-map").click(function(b){b.preventDefault(),$(".map").is(":visible")?($(".map").hide(),$(".map-container").removeClass("active")):($(".map-container").addClass("active"),$(".map").show(),a.refreshMapAfterShow())}),$("input[type=radio][name=search-type]").unbind("change"),$("input[type=radio][name=search-type]").change(function(){$("input[type=radio][name=search-type]").removeClass("active"),a.refreshSearch()}),$(".js-close-mobile-search").unbind("click"),$(".js-close-mobile-search").click(function(a){a.preventDefault(),$(".map").is(":visible")&&($(".map").hide(),$(".map-container").removeClass("active"))}),$(".searchlist .img-wrapper, .pictures-start .img-wrapper").unbind("click"),$(".searchlist .img-wrapper, .pictures-start .img-wrapper").click(function(a){$(".searchlist .img-wrapper, .pictures-start .img-wrapper").removeClass("active"),$(this).toggleClass("active")})},this.registerListenersForSlider=function(){$(".searchresult-wrapper-js").unbind("click"),$(".searchresult-wrapper-js").click(function(a){$(this).toggleClass("active")})},this.refreshMapAfterShow=function(){google.maps.event.trigger(map,"resize")},this.refreshStartsearch=function(){var a=this;$.ajax({type:"POST",url:"/xsite/call/fe_search/getStartResults",data:{lang:top.P_LANG},success:function(b){b.success&&($(".js-replacer-pictures-start").length>0&&$(".js-replacer-pictures-start").html(b.html),a.registerListeners())}})},this.refreshSearch=function(a){var b=this,c=1;if(0!=window.location.pathname.indexOf("/de/suche")&&0!=window.location.pathname.indexOf("/en/suche")){var d="/de/suche";"en"==top.P_LANG&&(d="/en/suche"),window.location=d}1!=currentFace&&fe_core.showLoader();var e=new Object;"undefined"==typeof a&&(e.date=$(".searchform .search-date").val(),e.location=$(".searchform .location-hidden-container :input").serialize(),e.adresse=$(".searchform .autocomplete-location").val(),$("#slider-range").length>0&&(e.price_from=$("#slider-range").slider("values",0),e.price_to=$("#slider-range").slider("values",1)),$("#umkreis-slider").length>0&&(e.range=$("#umkreis-slider").slider("option","value")),c=0);var f="",g=$("input[type='radio'][name='search-type']:checked");g.length>0?f=g.val():(g=$("input[type='radio'][name='search-type'].active"),f=g.val()),e.type=f,e.filter=$(".js-search-filter").val(),this.searchData=e,b.activateEndlessScrolling(),$.ajax({type:"POST",url:"/xsite/call/fe_search/getResults",data:{showAll:0,returnJson:1,lang:top.P_LANG,searchData:JSON.stringify(e),xr_face:currentFace,p_id:top.P_ID,xxx:"case1"},success:function(a){top.endOfResults=a.endOfResults,fe_core.hideLoader(),a.success&&($(".js-replacer-search").length>0&&$(".js-replacer-search").html(a.html),$(".search-slider").length>0&&($(".search-slider").html(a.html),top.searchsliderHtmlOrig=a.html),1==fe_core.getCurrentFace()&&b.refreshSearchMobileSpecials(a),b.activateEndlessScrolling(),b.updateMapWithResults(a.results),b.registerListeners(),fe_user.registerListeners())},failure:function(a){fe_core.hideLoader()}})},this.getNewSearchResults=function(a){var b=this,c="";$.ajax({type:"POST",url:"/xsite/call/fe_search/getResults",data:{showAll:0,returnJson:1,lang:top.P_LANG,offset:a+1,searchData:JSON.stringify(b.searchData),xr_face:currentFace,p_id:top.P_ID,xxx:"case2"},success:function(a){c=a.html,top.new_sliderdata=a.html,top.endOfResults=a.endOfResults,$(document).trigger("new_sliderdata_ready")},failure:function(a){console.log("failure endless")}})},this.activateEndlessScrollingMobile=function(){var a=this;if($(".search-slider").length>0){var b=$(".search-slider").data("royalSlider"),c=b.currSlideId;if($(".ajax-loader").show(),1==top.endOfResults)return void $(".ajax-loader").hide();a.getNewSearchResults(c);$(document).one("new_sliderdata_ready",function(){if(1==top.endOfResults)return void $(".ajax-loader").hide();top.searchsliderHtmlOrig+=top.new_sliderdata,b.destroy(),$(".search-slider").empty().html(top.searchsliderHtmlOrig),$(".search-slider").royalSlider({arrowsNav:!1,arrowsNavAutoHide:!1,fadeinLoadedSlide:!1,controlNavigationSpacing:0,controlNavigation:"none",thumbs:!1,imageScaleMode:"fill",imageAlignCenter:!1,loop:!1,loopRewind:!1,numImagesToPreload:6,keyboardNavEnabled:!0,usePreloader:!1,slidesSpacing:0,navigateByClick:!1,startSlideId:c}),$(".ajax-loader").hide();var d=$(".search-slider").data("royalSlider");d.ev.on("rsAfterSlideChange",function(){d.numSlides==d.currSlideId+1&&a.activateEndlessScrollingMobile(),a.registerListenersForSlider()}),a.registerListenersForSlider()})}},this.activateEndlessScrolling=function(){if(1!=fe_core.getCurrentFace()){var a=this,b=" ";return console.log("activate endless scrolling",this.interval),this.interval&&(clearInterval(this.interval),$(".middle-row .scrollbarfix").unbind("scroll"),$(".middle-row .scrollbarfix").scrollTop(0)),this.interval=$(".middle-row").endlessScroll({insertAfter:".middle-row .js-replacer-search .searchresult-single:last",inflowPixels:300,content:function(c,d,e){return"next"==e&&$.ajax({type:"POST",url:"/xsite/call/fe_search/getResults",data:{showAll:0,returnJson:1,lang:top.P_LANG,offset:c+1,searchData:JSON.stringify(a.searchData),xr_face:currentFace,p_id:top.P_ID,xxx:"case3"},success:function(c){1==c.endOfResults&&(clearInterval(a.interval),$(".middle-row .scrollbarfix").unbind("scroll"),$(".middle-row .scrollbarfix").scrollTop(0)),b=c.html},failure:function(a){console.log("failure endless")}}),b}}),b}},this.deActivateEndlessScrolling=function(){return!0},this.refreshSearchMobileSpecials=function(){var a=!1;"/de/suche"==window.location.pathname&&(a=!0),a===!0&&(0==$(".ergebnisse-anzeigen").visible()&&$("body").animate({scrollTop:$(".ergebnisse-anzeigen").offset().top},500),$(".footer-search-results").css("color","#04e0d7"),$(".footer-search-results").effect("pulsate",{times:2},1500,function(){$(".footer-search-results").css("color","inherit")}))},this.initializeSearchMap=function(a){var b=this;if(void 0!==typeof a){var c;"string"==typeof a?c=$(a):"object"==typeof a&&(c=a)}else var c=$(".map").first();c.gmap3({map:{options:{zoom:14,mapTypeId:"wsfStyle",zoomControl:!1}},styledmaptype:{id:"wsfStyle",options:{name:"Who showers first Style"},styles:[{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#c3c9cd"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#e1e4e6"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#04e0d7"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#1caf9a"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#585858"}]},{featureType:"transit.station",elementType:"geometry.fill",stylers:[{color:"#585858"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#0695b3"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#b0b5b9"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{visibility:"on"}]},{featureType:"road",elementType:"labels.icon",stylers:[{hue:"#e60046"}]}]}});var d=new google.maps.LatLng(48.2081743,16.37381890000006);this.searchMap.map=c.gmap3("get"),this.searchMap.map.setCenter(d),this.searchMap.marker=new google.maps.Marker({map:b.searchMap.map,position:d,options:{icon:{url:"/xstorage/template/img/map_marker.png",scaledSize:new google.maps.Size(50,50),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(30,50)}}}),this.searchMap.radius.shape=new google.maps.Circle({map:b.searchMap.map,radius:1e3*b.searchMap.radius.value,fillColor:"#04e0d7",fillOpacity:.15,strokeOpacity:0}),this.searchMap.radius.shape.bindTo("center",this.searchMap.marker,"position"),console.log("zoom controls",b.searchMap.map);var e=document.createElement("div"),f=new this.ZoomControl(e,b.searchMap.map,"-",function(){fe_map.zoomOut(1,c)});e.index=1,this.searchMap.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),e=document.createElement("div"),f=new this.ZoomControl(e,b.searchMap.map,"+",function(){fe_map.zoomIn(1,c)}),e.index=1,this.searchMap.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),this.checkIfNeedToPan()},this.checkIfNeedToPan=function(){if(top.showOnMap){var c,a=parseFloat(showOnMap.lat),b=parseFloat(showOnMap.lng);top.showOnMap.el?"string"==typeof top.showOnMap.el?(c=$(showOnMap.el),console.log("case1")):"object"==typeof top.showOnMap.el&&(c=top.showOnMap.el,console.log("case2")):(c=$(".map").first(),console.log("case3")),c.length>0&&a>0&&b>0&&(console.log("checkIfNeedToMap true - ",a,b,c),this.centerMapOnPoint(a,b,c))}if(top.showOnMap2){var c,a=parseFloat(showOnMap2.lat),b=parseFloat(showOnMap2.lng);top.showOnMap2.el?"string"==typeof top.showOnMap2.el?c=$(top.showOnMap2.el):"object"==typeof top.showOnMap2.el&&(c=top.showOnMap2.el):c=$(".map").first(),c.length>0&&a>0&&b>0&&this.centerMapOnPoint(a,b,c)}},this.updateMapWithResults=function(a){var b=this;0!=a&&$(".map").length>0&&a.forEach(function(a){$(".map").each(function(c,d){"undefined"!=typeof a.LAT&&"undefined"!=typeof a.LNG&&b.addMarkerToMap(a.LAT,a.LNG,a.URL,a.user_id,$(d))})})},this.addMarkerToMap=function(a,b,c,d,e){var f=new google.maps.LatLng(a,b);this.searchMap.map=e.gmap3("get"),this.searchMap.marker=new google.maps.Marker({map:this.searchMap.map,position:f,options:{icon:{url:"/xstorage/template/img/map_marker.png",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,30)}},url:c,dataid:d}),this.allMarkers.push({id:d,obj:this.searchMap.marker}),google.maps.event.addListener(this.searchMap.marker,"click",function(){window.location.href=this.url}),google.maps.event.addListener(this.searchMap.marker,"mouseover",function(){var a=$('.searchlist .img-wrapper[data-userId="'+this.dataid+'"]');a.length>0&&($(a).addClass("active"),$("div.middle-row").animate({scrollTop:a.offset().top},500))}),google.maps.event.addListener(this.searchMap.marker,"mouseout",function(){var a=$('.searchlist .img-wrapper[data-userId="'+this.dataid+'"]');$(a).removeClass("active")})},this.panToMarker=function(a){var b=!1;$.each(this.allMarkers,function(){this.id==a&&(b=this)}),0!=b&&(this.searchMap.map=$(".map").first().gmap3("get"),$(".map").animate({"border-color":"#04e0d7","border-style":"solid","border-width":"6px"},500).animate({"border-color":"transparent","border-style":"solid","border-width":"1px"},500),this.searchMap.map.panTo(b.obj.position))},this.centerMapOnPoint=function(a,b,c){var d=new google.maps.LatLng(a,b);console.info(c),this.searchMap.map=c.gmap3("get"),void 0!==this.searchMap.map&&(this.searchMap.map.setCenter(d),this.searchMap.marker.setPosition(d))},this.ZoomControl=function(a,b,c,d){var e=document.createElement("div");e.style.backgroundColor="#04e0d7",e.style.borderRadius="50%",e.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",e.style.cursor="pointer",e.style.textAlign="center",e.style.width="25px",e.style.height="25px",e.style.marginRight="10px",e.style.marginBottom="5px",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.userSelect="none",a.appendChild(e);var f=document.createElement("div");f.style.color="#000000",f.style.fontFamily="Roboto,Arial,sans-serif",f.style.fontWeight="bold",f.style.fontSize="16px",f.style.lineHeight="25px",f.innerHTML=c,e.appendChild(f),google.maps.event.addDomListener(e,"click",d)},this.zoomIn=function(a,b){var d,c=1;d="object"==typeof b?b.gmap3("get"):"string"==typeof b?$(b).gmap3("get"):$(".map").first().gmap3("get");var e=d.getZoom();e<21-c&&d.setZoom(e+c)},this.zoomOut=function(a,b){var d,c=1;d="object"==typeof b?b.gmap3("get"):"string"==typeof b?$(b).gmap3("get"):$(".map").first().gmap3("get");var e=d.getZoom();e>-1+c&&d.setZoom(e-c)}}}();$(document).ready(function(){fe_map.init()});
